print(" > Done.")
print(" > Creating values table...")
z_values <- values_table()
print(" > Done.")
print(" > Change count tables, daily vaccination rate percent change category...")
f_dvr_change_count <- vxrate_change_cat(a_data, b_vxrate_change_lw)
print(" > Done.")
print(" > Loading eda consolidation data back to global environment...")
env$vrcat_list <- vrcat_list
env$e_vrcat_all <- vrcat_list[["all"]]
env$e_trend_all <- vrcat_list[["trend"]]
env$e_booster_all <- vrcat_list[["booster"]]
env$tgt_list <- tgt_list
env$e_tar_past_all <- tgt_list
env$e_tar_cur_all <- tgt_list
env$e_tar_cur_scale_all <- tgt_list
env$supp_list <- supp_list
env$e_secdelpu_all <- supp_list[["all"]]
env$e_cov_all <- supp_list[["coverage"]]
env$z_values <- z_values
env$f_dvr_change_count <- f_dvr_change_count
return(environment())
}
run_consolidate(a_data)
View(f_dvr_change_count)
library("readxl")
library("writexl")
library("countrycode")
library("dplyr")
library("lubridate")
library("tidyr")
library("data.table")
library("bit64")
# HELPERS
source("helpers/joins.r")
source("helpers/transformations.r")
# ETL
source("src/base/run_base.r")
source("src/entity/run_entity.r")
source("src/population/run_population.r")
source("src/supply/run_supply.R")
source("src/vaccines/run_vaccines.r")
base_env <- run_base()
entity_env <- run_entity()
pop_env <- run_population()
supply_env <- run_supply()
vaccines_env <- run_vaccines(entity_characteristics)
# EDA
source("eda/vxrate/run_vxrate.r")
source("eda/supplies/run_supplies.r")
source("eda/coverage/run_coverage.r")
source("eda/product/run_product.r")
source("eda/rank-bin/run_rank_bin.r")
source("eda/consolidate/run_consolidate.r")
vxrate_env <- run_vxrate(entity_characteristics, population_data, uptake_gender_data, c_vxrate_latest)
supplies_env <- run_eda_supplies(a_data, supply_secured, delivery_courses_doses)
coverage_env <- run_coverage(a_data)
product_env <- run_product(a_data, base_env$b_smartsheet, base_env$b_csl)
ranking_env <- run_binning(a_data)
consolidate_env <- run_consolidate(a_data)
# rows 2698 - 3280
run_consolidate <- function(a_data, env = .GlobalEnv) {
source("eda/consolidate/consolidate_base_file.r")
source("eda/consolidate/consolidate_vxrate.r")
source("eda/consolidate/consolidate_targets.r")
source("eda/consolidate/consolidate_supplies_utilization.r")
source("eda/consolidate/consolidate_tables.r")
print(" > Starting local environment for consolidation summary")
print(" > Consolidating base file...")
condense_list <- load_base_condense_file(a_data)
print(" > Done.")
print(" > Consolidating Vaccination rate...")
vrcat_list <- vxrate(condense_list)
print(" > Done.")
print(" > Consolidating targets...")
tgt_list <- targets(condense_list)
print(" > Done.")
print(" > Consolidating Supplies & Product utilization...")
supp_list <- supplies_cons(condense_list)
print(" > Done.")
print(" > Creating values table...")
z_values <- values_table()
print(" > Done.")
print(" > Change count tables, daily vaccination rate percent change category...")
f_dvr_change_count <- vxrate_change_cat(a_data, b_vxrate_change_lw)
print(" > Done.")
print(" > Coverage category change...")
f_cov_change_count <- cov_cat_change()
print(" > Done.")
print(" > Loading eda consolidation data back to global environment...")
env$vrcat_list <- vrcat_list
env$e_vrcat_all <- vrcat_list[["all"]]
env$e_trend_all <- vrcat_list[["trend"]]
env$e_booster_all <- vrcat_list[["booster"]]
env$tgt_list <- tgt_list
env$e_tar_past_all <- tgt_list
env$e_tar_cur_all <- tgt_list
env$e_tar_cur_scale_all <- tgt_list
env$supp_list <- supp_list
env$e_secdelpu_all <- supp_list[["all"]]
env$e_cov_all <- supp_list[["coverage"]]
env$z_values <- z_values
env$f_dvr_change_count <- f_dvr_change_count
env$f_cov_change_count <- f_cov_change_count
return(environment())
}
run_consolidate(a_data)
# rows 2698 - 3280
run_consolidate <- function(a_data, env = .GlobalEnv) {
source("eda/consolidate/consolidate_base_file.r")
source("eda/consolidate/consolidate_vxrate.r")
source("eda/consolidate/consolidate_targets.r")
source("eda/consolidate/consolidate_supplies_utilization.r")
source("eda/consolidate/consolidate_tables.r")
print(" > Starting local environment for consolidation summary")
print(" > Consolidating base file...")
condense_list <- load_base_condense_file(a_data)
print(" > Done.")
print(" > Consolidating Vaccination rate...")
vrcat_list <- vxrate(condense_list)
print(" > Done.")
print(" > Consolidating targets...")
tgt_list <- targets(condense_list)
print(" > Done.")
print(" > Consolidating Supplies & Product utilization...")
supp_list <- supplies_cons(condense_list)
print(" > Done.")
print(" > Creating values table...")
z_values <- values_table()
print(" > Done.")
print(" > Change count tables, daily vaccination rate percent change category...")
f_dvr_change_count <- vxrate_change_cat(a_data, b_vxrate_change_lw)
print(" > Done.")
print(" > Coverage category change...")
f_cov_change_count <- cov_cat_change(a_data)
print(" > Done.")
print(" > Loading eda consolidation data back to global environment...")
env$vrcat_list <- vrcat_list
env$e_vrcat_all <- vrcat_list[["all"]]
env$e_trend_all <- vrcat_list[["trend"]]
env$e_booster_all <- vrcat_list[["booster"]]
env$tgt_list <- tgt_list
env$e_tar_past_all <- tgt_list
env$e_tar_cur_all <- tgt_list
env$e_tar_cur_scale_all <- tgt_list
env$supp_list <- supp_list
env$e_secdelpu_all <- supp_list[["all"]]
env$e_cov_all <- supp_list[["coverage"]]
env$z_values <- z_values
env$f_dvr_change_count <- f_dvr_change_count
env$f_cov_change_count <- f_cov_change_count
return(environment())
}
run_consolidate(a_data)
View(f_cov_change_count)
View(f_dvr_change_count)
View(f_cov_change_count)
# rows 2698 - 3280
run_consolidate <- function(a_data, env = .GlobalEnv) {
source("eda/consolidate/consolidate_base_file.r")
source("eda/consolidate/consolidate_vxrate.r")
source("eda/consolidate/consolidate_targets.r")
source("eda/consolidate/consolidate_supplies_utilization.r")
source("eda/consolidate/consolidate_tables.r")
print(" > Starting local environment for consolidation summary")
print(" > Consolidating base file...")
condense_list <- load_base_condense_file(a_data)
print(" > Done.")
print(" > Consolidating Vaccination rate...")
vrcat_list <- vxrate(condense_list)
print(" > Done.")
print(" > Consolidating targets...")
tgt_list <- targets(condense_list)
print(" > Done.")
print(" > Consolidating Supplies & Product utilization...")
supp_list <- supplies_cons(condense_list)
print(" > Done.")
print(" > Creating values table...")
z_values <- values_table()
print(" > Done.")
print(" > Change count tables, daily vaccination rate percent change category...")
f_dvr_change_count <- vxrate_change_cat(a_data, b_vxrate_change_lw)
print(" > Done.")
print(" > Coverage category change...")
f_cov_change_count <- cov_cat_change(a_data)
print(" > Done.")
print(" > Loading eda consolidation data back to global environment...")
env$vrcat_list <- vrcat_list
env$e_vrcat_all <- vrcat_list[["all"]]
env$e_trend_all <- vrcat_list[["trend"]]
env$e_booster_all <- vrcat_list[["booster"]]
env$tgt_list <- tgt_list
env$e_tar_past_all <- tgt_list
env$e_tar_cur_all <- tgt_list
env$e_tar_cur_scale_all <- tgt_list
env$supp_list <- supp_list
env$e_secdelpu_all <- supp_list[["all"]]
env$e_cov_all <- supp_list[["coverage"]]
env$z_values <- z_values
env$f_dvr_change_count <- f_dvr_change_count
env$f_cov_change_count <- f_cov_change_count
return(environment())
}
run_consolidate(a_data)
# rows 2698 - 3280
run_consolidate <- function(a_data, env = .GlobalEnv) {
source("eda/consolidate/consolidate_base_file.r")
source("eda/consolidate/consolidate_vxrate.r")
source("eda/consolidate/consolidate_targets.r")
source("eda/consolidate/consolidate_supplies_utilization.r")
source("eda/consolidate/consolidate_tables.r")
print(" > Starting local environment for consolidation summary")
print(" > Consolidating base file...")
condense_list <- load_base_condense_file(a_data)
print(" > Done.")
print(" > Consolidating Vaccination rate...")
vrcat_list <- vxrate(condense_list)
print(" > Done.")
print(" > Consolidating targets...")
tgt_list <- targets(condense_list)
print(" > Done.")
print(" > Consolidating Supplies & Product utilization...")
supp_list <- supplies_cons(condense_list)
print(" > Done.")
print(" > Creating values table...")
z_values <- values_table()
print(" > Done.")
print(" > Change count tables, daily vaccination rate percent change category...")
f_dvr_change_count <- vxrate_change_cat(a_data, b_vxrate_change_lw)
print(" > Done.")
print(" > Coverage category change...")
f_cov_change_count <- cov_cat_change(a_data)
print(" > Done.")
print(" > Loading eda consolidation data back to global environment...")
env$vrcat_list <- vrcat_list
env$e_vrcat_all <- vrcat_list[["all"]]
env$e_trend_all <- vrcat_list[["trend"]]
env$e_booster_all <- vrcat_list[["booster"]]
env$tgt_list <- tgt_list
env$e_tar_past_all <- tgt_list
env$e_tar_cur_all <- tgt_list
env$e_tar_cur_scale_all <- tgt_list
env$supp_list <- supp_list
env$e_secdelpu_all <- supp_list[["all"]]
env$e_cov_all <- supp_list[["coverage"]]
env$z_values <- z_values
env$f_dvr_change_count <- f_dvr_change_count
env$f_cov_change_count <- f_cov_change_count
return(environment())
}
run_consolidate(a_data)
# rows 2698 - 3280
run_consolidate <- function(a_data, env = .GlobalEnv) {
source("eda/consolidate/consolidate_base_file.r")
source("eda/consolidate/consolidate_vxrate.r")
source("eda/consolidate/consolidate_targets.r")
source("eda/consolidate/consolidate_supplies_utilization.r")
source("eda/consolidate/consolidate_tables.r")
print(" > Starting local environment for consolidation summary")
print(" > Consolidating base file...")
condense_list <- load_base_condense_file(a_data)
print(" > Done.")
print(" > Consolidating Vaccination rate...")
vrcat_list <- vxrate(condense_list)
print(" > Done.")
print(" > Consolidating targets...")
tgt_list <- targets(condense_list)
print(" > Done.")
print(" > Consolidating Supplies & Product utilization...")
supp_list <- supplies_cons(condense_list)
print(" > Done.")
print(" > Creating values table...")
z_values <- values_table()
print(" > Done.")
print(" > Change count tables, daily vaccination rate percent change category...")
f_dvr_change_count <- vxrate_change_cat(a_data, b_vxrate_change_lw)
print(" > Done.")
print(" > Coverage category change...")
f_cov_change_count <- cov_cat_change(a_data)
print(" > Done.")
print(" > Loading eda consolidation data back to global environment...")
env$vrcat_list <- vrcat_list
env$e_vrcat_all <- vrcat_list[["all"]]
env$e_trend_all <- vrcat_list[["trend"]]
env$e_booster_all <- vrcat_list[["booster"]]
env$tgt_list <- tgt_list
env$e_tar_past_all <- tgt_list
env$e_tar_cur_all <- tgt_list
env$e_tar_cur_scale_all <- tgt_list
env$supp_list <- supp_list
env$e_secdelpu_all <- supp_list[["all"]]
env$e_cov_all <- supp_list[["coverage"]]
env$z_values <- z_values
env$f_dvr_change_count <- f_dvr_change_count
env$f_cov_change_count <- f_cov_change_count
return(environment())
}
run_consolidate(a_data)
library("readxl")
library("writexl")
library("countrycode")
library("dplyr")
library("lubridate")
library("tidyr")
library("data.table")
library("bit64")
# HELPERS
source("helpers/joins.r")
source("helpers/transformations.r")
# ETL
source("src/base/run_base.r")
source("src/entity/run_entity.r")
source("src/population/run_population.r")
source("src/supply/run_supply.R")
source("src/vaccines/run_vaccines.r")
base_env <- run_base()
entity_env <- run_entity()
pop_env <- run_population()
supply_env <- run_supply()
vaccines_env <- run_vaccines(entity_characteristics)
# EDA
source("eda/vxrate/run_vxrate.r")
source("eda/supplies/run_supplies.r")
source("eda/coverage/run_coverage.r")
source("eda/product/run_product.r")
source("eda/rank-bin/run_rank_bin.r")
source("eda/consolidate/run_consolidate.r")
vxrate_env <- run_vxrate(entity_characteristics, population_data, uptake_gender_data, c_vxrate_latest)
supplies_env <- run_eda_supplies(a_data, supply_secured, delivery_courses_doses)
coverage_env <- run_coverage(a_data)
product_env <- run_product(a_data, base_env$b_smartsheet, base_env$b_csl)
ranking_env <- run_binning(a_data)
consolidate_env <- run_consolidate(a_data)
# Rows 3283 - 3308 of original code.
run_export <- function(env = .GlobalEnv) {
source("eda/export/export.r")
print(" > Starting local environment for data export to excel file")
output_report <- write_to_excel()
print(" > Done.")
print(" > Loading excel file back to global environment...")
env$output_report <- output_report
print(" > Done.")
return(environment())
}
run_export()
View(supplies_env)
View(supply_env)
# Rows 3283 - 3308 of original code.
run_export <- function(env = .GlobalEnv) {
source("eda/export/export.r")
print(" > Starting local environment for data export to excel file")
output_report <- write_to_excel()
print(" > Done.")
print(" > Loading excel file back to global environment...")
env$output_report <- output_report
print(" > Done.")
return(environment())
}
run_export()
View(supp_list)
View(supp_list)
View(supplies_env)
# rows 985 - 1650
run_supply <- function(env = .GlobalEnv) {
print(" > Starting local environment for supply module...")
source("src/supply/supply_forecast.r", TRUE)
source("src/supply/supply_secured.r", TRUE)
source("src/supply/supply_received.r", TRUE)
print(" > Secured supply...")
supply_secured <- extract_supply_secured()
# FIXME hardcoded date
supply_secured <- transform_supply_secured(
supply_secured,
dataset_date = "2020-11-20"
)
print(" > Done.")
print(" > Forecasted supply...")
supply_forecast <- extract_supply_forecast()
supply_forecast_total <- transform_supply_forecast(supply_forecast)
print(" > Done.")
print(" > Received supply...")
supply_received <- load_sup_rec()
supply_received_doses <- transform_sup_rec_doses(supply_received)
supply_received_produ <- transform_sup_rec_product(supply_received)
delivery_courses_doses <- eda_sup_rec_courses(
supply_received, supply_received_doses
)
print(" > Done.")
print(" > Loading supply data back to global environment...")
env$supply_forecast_total <- supply_forecast_total
env$supply_secured <- supply_secured
env$delivery_courses_doses <- delivery_courses_doses
env$dsupply_received_product <- supply_received_produ
env$supply_received_doses <- supply_received_doses
print(" > OK.")
return(environment())
}
run_supply()
# Rows 3283 - 3308 of original code.
run_export <- function(env = .GlobalEnv) {
source("eda/export/export.r")
print(" > Starting local environment for data export to excel file")
output_report <- write_to_excel()
print(" > Done.")
print(" > Loading excel file back to global environment...")
env$output_report <- output_report
print(" > Done.")
return(environment())
}
run_export()
library("readxl")
library("writexl")
library("countrycode")
library("dplyr")
library("lubridate")
library("tidyr")
library("data.table")
library("bit64")
# HELPERS
source("helpers/joins.r")
source("helpers/transformations.r")
# ETL
source("src/base/run_base.r")
source("src/entity/run_entity.r")
source("src/population/run_population.r")
source("src/supply/run_supply.R")
source("src/vaccines/run_vaccines.r")
base_env <- run_base()
entity_env <- run_entity()
pop_env <- run_population()
supply_env <- run_supply()
vaccines_env <- run_vaccines(entity_characteristics)
# EDA
source("eda/vxrate/run_vxrate.r")
source("eda/supplies/run_supplies.r")
source("eda/coverage/run_coverage.r")
source("eda/product/run_product.r")
source("eda/rank-bin/run_rank_bin.r")
source("eda/consolidate/run_consolidate.r")
vxrate_env <- run_vxrate(entity_characteristics, population_data, uptake_gender_data, c_vxrate_latest)
supplies_env <- run_eda_supplies(a_data, supply_secured, delivery_courses_doses)
coverage_env <- run_coverage(a_data)
product_env <- run_product(a_data, base_env$b_smartsheet, base_env$b_csl)
ranking_env <- run_binning(a_data)
consolidate_env <- run_consolidate(a_data)
# Rows 3283 - 3308 of original code.
# install.packages('openxlsx') # Install just once
# library(openxlsx)
run_export <- function(env = .GlobalEnv) {
source("eda/export/export.r")
print(" > Starting local environment for data export to excel file")
output_report <- write_to_excel()
print(" > Done.")
print(" > Loading excel file back to global environment...")
env$output_report <- output_report
print(" > Done.")
return(environment())
}
run_export()
install.packages('openxlsx') # Install just once
# install.packages('openxlsx') # Install just once
library(openxlsx)
run_export <- function(env = .GlobalEnv) {
source("eda/export/export.r")
print(" > Starting local environment for data export to excel file")
output_report <- write_to_excel()
print(" > Done.")
print(" > Loading excel file back to global environment...")
env$output_report <- output_report
print(" > Done.")
return(environment())
}
run_export()
# Write to Excel
write_to_excel <- function() {
all_df <- list(
"0_base_data" = a_data,
"1_absorption_month" = d_absorption,
"1_adm_dvr_long" = b_vxrate_amc,
"1_adm_all_long" = b_vxrate_pub,
"1_delivery_doses" = supply_received_doses,
"2_base_data_amc" = a_data_amc,
"2_base_data_hic" = a_data_hic,
"2_dvr_perchange_count" = f_dvr_change_count,
"2_cov_change_count" = f_cov_change_count,
"8_dvr_cat" = e_vrcat_all,
"8_dvr_lm_trend" = e_trend_all,
"8_tarpast_cat" = e_tar_past_all,
"8_curtar_cat" = e_tar_cur_all,
"8_curtar_scale_cat" = e_tar_cur_scale_all,
"8_booster_status" = e_booster_all,
"8_secdelpu_cat" = e_secdelpu_all,
"8_cov_cat" = e_cov_all,
"9_values" = z_values
)
# write.xlsx(all_df, "output/output_master.xlsx")
write.xlsx(all_df, "data/output/test_master.xlsx")
}
# Rows 3283 - 3308 of original code.
# install.packages('openxlsx') # Install just once
library(openxlsx)
run_export <- function(env = .GlobalEnv) {
source("eda/export/export.r")
print(" > Starting local environment for data export to excel file")
output_report <- write_to_excel()
print(" > Done.")
print(" > Loading excel file back to global environment...")
env$output_report <- output_report
print(" > Done.")
return(environment())
}
run_export()
