age_group == "Y12" |
age_group == "Y13" |
age_group == "Y14" |
age_group == "Y15" |
age_group == "Y16" |
age_group == "Y17" |
age_group == "Y18" |
age_group == "Y19" |
age_group == "Y20" |
age_group == "Y21" |
age_group == "Y22" |
age_group == "Y23" |
age_group == "Y24" |
age_group == "Y25" |
age_group == "Y26" |
age_group == "Y27" |
age_group == "Y28" |
age_group == "Y29" |
age_group == "Y30" |
age_group == "Y31" |
age_group == "Y32" |
age_group == "Y33" |
age_group == "Y34" |
age_group == "Y35" |
age_group == "Y36" |
age_group == "Y37" |
age_group == "Y38" |
age_group == "Y39" |
age_group == "Y40" |
age_group == "Y41" |
age_group == "Y42" |
age_group == "Y43" |
age_group == "Y44" |
age_group == "Y45" |
age_group == "Y46" |
age_group == "Y47" |
age_group == "Y48" |
age_group == "Y49" |
age_group == "Y50" |
age_group == "Y51" |
age_group == "Y52" |
age_group == "Y53" |
age_group == "Y54" |
age_group == "Y55" |
age_group == "Y56" |
age_group == "Y57" |
age_group == "Y58" |
age_group == "Y59" |
age_group == "Y60" |
age_group == "Y61" |
age_group == "Y62" |
age_group == "Y63" |
age_group == "Y64" |
age_group == "Y65" |
age_group == "Y66" |
age_group == "Y67" |
age_group == "Y68" |
age_group == "Y69" |
age_group == "Y70" |
age_group == "Y71" |
age_group == "Y72" |
age_group == "Y73" |
age_group == "Y74" |
age_group == "Y75" |
age_group == "Y76" |
age_group == "Y77" |
age_group == "Y78" |
age_group == "Y79" |
age_group == "Y80" |
age_group == "Y81" |
age_group == "Y82" |
age_group == "Y83" |
age_group == "Y84" |
age_group == "Y85" |
age_group == "Y86" |
age_group == "Y87" |
age_group == "Y88" |
age_group == "Y89" |
age_group == "Y90" |
age_group == "Y91" |
age_group == "Y92" |
age_group == "Y93" |
age_group == "Y94" |
age_group == "Y95" |
age_group == "Y96" |
age_group == "Y97" |
age_group == "Y98" |
age_group == "Y99" |
age_group == "Y100"
)
) %>%
group_by(a_iso) %>%
summarize_at("value",
sum,
na.rm = TRUE
)
colnames(test) <- c("a_iso","test")
View(test)
z_pop_18p <- z_pop_total %>%
filter(
gender == "BOTH" & age_group%in%age_range18) %>%
group_by(a_iso) %>%
summarize_at("value",
sum,
na.rm = TRUE
)
colnames(z_pop_18p) <- c("a_iso","a_pop_18p")
View(z_pop_18p)
test_18 <- z_pop_total %>%
filter(
gender == "BOTH" & (
age_group == "Y18" |
age_group == "Y19" |
age_group == "Y20" |
age_group == "Y21" |
age_group == "Y22" |
age_group == "Y23" |
age_group == "Y24" |
age_group == "Y25" |
age_group == "Y26" |
age_group == "Y27" |
age_group == "Y28" |
age_group == "Y29" |
age_group == "Y30" |
age_group == "Y31" |
age_group == "Y32" |
age_group == "Y33" |
age_group == "Y34" |
age_group == "Y35" |
age_group == "Y36" |
age_group == "Y37" |
age_group == "Y38" |
age_group == "Y39" |
age_group == "Y40" |
age_group == "Y41" |
age_group == "Y42" |
age_group == "Y43" |
age_group == "Y44" |
age_group == "Y45" |
age_group == "Y46" |
age_group == "Y47" |
age_group == "Y48" |
age_group == "Y49" |
age_group == "Y50" |
age_group == "Y51" |
age_group == "Y52" |
age_group == "Y53" |
age_group == "Y54" |
age_group == "Y55" |
age_group == "Y56" |
age_group == "Y57" |
age_group == "Y58" |
age_group == "Y59" |
age_group == "Y60" |
age_group == "Y61" |
age_group == "Y62" |
age_group == "Y63" |
age_group == "Y64" |
age_group == "Y65" |
age_group == "Y66" |
age_group == "Y67" |
age_group == "Y68" |
age_group == "Y69" |
age_group == "Y70" |
age_group == "Y71" |
age_group == "Y72" |
age_group == "Y73" |
age_group == "Y74" |
age_group == "Y75" |
age_group == "Y76" |
age_group == "Y77" |
age_group == "Y78" |
age_group == "Y79" |
age_group == "Y80" |
age_group == "Y81" |
age_group == "Y82" |
age_group == "Y83" |
age_group == "Y84" |
age_group == "Y85" |
age_group == "Y86" |
age_group == "Y87" |
age_group == "Y88" |
age_group == "Y89" |
age_group == "Y90" |
age_group == "Y91" |
age_group == "Y92" |
age_group == "Y93" |
age_group == "Y94" |
age_group == "Y95" |
age_group == "Y96" |
age_group == "Y97" |
age_group == "Y98" |
age_group == "Y99" |
age_group == "Y100"
)
) %>%
group_by(a_iso) %>%
summarize_at("value",
sum,
na.rm = TRUE
)
colnames(test_18) <- c("a_iso","a_pop_18p")
View(test_18)
# Filter for 60 and above
z_pop_60p <- z_pop_total %>%
filter(
gender == "BOTH" & (
age_group == "Y60" |
age_group == "Y61" |
age_group == "Y62" |
age_group == "Y63" |
age_group == "Y64" |
age_group == "Y65" |
age_group == "Y66" |
age_group == "Y67" |
age_group == "Y68" |
age_group == "Y69" |
age_group == "Y70" |
age_group == "Y71" |
age_group == "Y72" |
age_group == "Y73" |
age_group == "Y74" |
age_group == "Y75" |
age_group == "Y76" |
age_group == "Y77" |
age_group == "Y78" |
age_group == "Y79" |
age_group == "Y80" |
age_group == "Y81" |
age_group == "Y82" |
age_group == "Y83" |
age_group == "Y84" |
age_group == "Y85" |
age_group == "Y86" |
age_group == "Y87" |
age_group == "Y88" |
age_group == "Y89" |
age_group == "Y90" |
age_group == "Y91" |
age_group == "Y92" |
age_group == "Y93" |
age_group == "Y94" |
age_group == "Y95" |
age_group == "Y96" |
age_group == "Y97" |
age_group == "Y98" |
age_group == "Y99" |
age_group == "Y100"
)
) %>%
group_by(a_iso) %>%
summarize_at("value",
sum,
na.rm = TRUE
)
colnames(z_pop_60p) <- c("a_iso","a_pop_60p")
View(z_pop_60p)
z_pop_60p <- z_pop_total %>%
filter(
gender == "BOTH" & age_group%in%age_range60) %>%
group_by(a_iso) %>%
summarize_at("value",
sum,
na.rm = TRUE
)
colnames(z_pop_60p) <- c("a_iso","a_pop_60p")
View(z_pop_60p)
z_pop_total_male <- z_pop_total %>%
filter(
gender == "MALE" & age_group == "ALL") %>%
group_by(a_iso) %>%
summarize_at("value",
sum,
na.rm = TRUE
)
colnames(z_pop_total_male) <- c("a_iso","a_pop_male")
z_pop_total_fem <- z_pop_total %>%
filter(
gender == "FEMALE" & age_group == "ALL") %>%
group_by(a_iso) %>%
summarize_at("value",
sum,
na.rm = TRUE
)
colnames(z_pop_total_fem) <- c("a_iso","a_pop_fem")
c_pop_disag <- left_join(z_pop_total_male, z_pop_total_fem, by = "a_iso") %>%
left_join(., z_pop_12p, by = "a_iso") %>%
left_join(., z_pop_18p, by = "a_iso") %>%
left_join(., z_pop_60p, by = "a_iso") %>%
full_join(., z_pop_hcw, by = "a_iso")
# Load datasets
b_uptake_target <-
data.frame(read_excel("input/data_export_WIISE_V_COV_UPTAKE_TARGETGROUP_LAST_MONTH_LONG.xlsx",
sheet = "v_COV_UPTAKE_TARGETGROUP_LAST_M"))
b_uptake_gender <-
data.frame(read_excel("input/data_export_WIISE_V_COV_UPTAKE_GENDER_LAST_MONTH_LONG.xlsx",
sheet = "v_COV_UPTAKE_GENDER_LAST_MONTH_"))
# Reduce columns & rename
c_uptake_target <- select(b_uptake_target, c("ISO_3_CODE",
"DATE",
"TARGET_GROUP",
"N_VACC_DOSE1",
"N_VACC_LAST_DOSE"))
colnames(c_uptake_target) <- c("a_iso","date", "target_group","adm_a1d","adm_fv")
c_uptake_gender <- select(b_uptake_gender, c("ISO_3_CODE",
"DATE",
"GENDER",
"N_VACC_DOSE1",
"N_VACC_LAST_DOSE"))
colnames(c_uptake_gender) <- c("a_iso","date", "gender","adm_a1d","adm_fv")
# Sort for healthcare workers, remove target columns & rename
c_uptake_hcw <- filter(c_uptake_target, target_group == "HW")
c_uptake_hcw <- select(c_uptake_hcw, -"target_group")
colnames(c_uptake_hcw) <- c("a_iso","adm_date_hcw", "adm_a1d_hcw", "adm_fv_hcw")
# Sort for elderly / 60+, remove target columns & rename
c_uptake_60p <- filter(c_uptake_target, target_group == "OLDER_60")
c_uptake_60p <- select(c_uptake_60p, -"target_group")
colnames(c_uptake_60p) <- c("a_iso","adm_date_60p", "adm_a1d_60p", "adm_fv_60p")
# Sort for males, remove target columns & rename
c_uptake_male <- filter(c_uptake_gender, gender  == "MALE")
c_uptake_male <- select(c_uptake_male, -"gender")
colnames(c_uptake_male) <- c("a_iso","adm_date_gender", "adm_a1d_male", "adm_fv_male")
# Sort for females, remove target columns & rename
c_uptake_fem <- filter(c_uptake_gender, gender == "FEMALE")
c_uptake_fem <- select(c_uptake_fem, -c("gender", "date"))
colnames(c_uptake_fem) <- c("a_iso","adm_a1d_fem", "adm_fv_fem")
# Merge dataframes
c_uptake_disag <- full_join(c_uptake_hcw, c_uptake_60p, by = "a_iso") %>%
full_join(., c_uptake_male, by = "a_iso") %>%
full_join(., c_uptake_fem, by = "a_iso")
# Load datasets
b_uptake_target <-
data.frame(read_excel("input/data_export_WIISE_V_COV_UPTAKE_TARGETGROUP_LAST_MONTH_LONG.xlsx",
sheet = "v_COV_UPTAKE_TARGETGROUP_LAST_M"))
b_uptake_target <-
data.frame(read_excel("data/input/data_export_WIISE_V_COV_UPTAKE_TARGETGROUP_LAST_MONTH_LONG.xlsx",
sheet = "v_COV_UPTAKE_TARGETGROUP_LAST_M"))
b_uptake_gender <-
data.frame(read_excel("data/input/data_export_WIISE_V_COV_UPTAKE_GENDER_LAST_MONTH_LONG.xlsx",
sheet = "v_COV_UPTAKE_GENDER_LAST_MONTH_"))
# Reduce columns & rename
c_uptake_target <- select(b_uptake_target, c("ISO_3_CODE",
"DATE",
"TARGET_GROUP",
"N_VACC_DOSE1",
"N_VACC_LAST_DOSE"))
colnames(c_uptake_target) <- c("a_iso","date", "target_group","adm_a1d","adm_fv")
c_uptake_gender <- select(b_uptake_gender, c("ISO_3_CODE",
"DATE",
"GENDER",
"N_VACC_DOSE1",
"N_VACC_LAST_DOSE"))
colnames(c_uptake_gender) <- c("a_iso","date", "gender","adm_a1d","adm_fv")
# Sort for healthcare workers, remove target columns & rename
c_uptake_hcw <- filter(c_uptake_target, target_group == "HW")
c_uptake_hcw <- select(c_uptake_hcw, -"target_group")
colnames(c_uptake_hcw) <- c("a_iso","adm_date_hcw", "adm_a1d_hcw", "adm_fv_hcw")
# Sort for elderly / 60+, remove target columns & rename
c_uptake_60p <- filter(c_uptake_target, target_group == "OLDER_60")
c_uptake_60p <- select(c_uptake_60p, -"target_group")
colnames(c_uptake_60p) <- c("a_iso","adm_date_60p", "adm_a1d_60p", "adm_fv_60p")
# Sort for males, remove target columns & rename
c_uptake_male <- filter(c_uptake_gender, gender  == "MALE")
c_uptake_male <- select(c_uptake_male, -"gender")
colnames(c_uptake_male) <- c("a_iso","adm_date_gender", "adm_a1d_male", "adm_fv_male")
# Sort for females, remove target columns & rename
c_uptake_fem <- filter(c_uptake_gender, gender == "FEMALE")
c_uptake_fem <- select(c_uptake_fem, -c("gender", "date"))
colnames(c_uptake_fem) <- c("a_iso","adm_a1d_fem", "adm_fv_fem")
# Merge dataframes
c_uptake_disag <- full_join(c_uptake_hcw, c_uptake_60p, by = "a_iso") %>%
full_join(., c_uptake_male, by = "a_iso") %>%
full_join(., c_uptake_fem, by = "a_iso")
View(c_pop_disag)
library("readxl")
library("writexl")
library("countrycode")
library("dplyr")
library("lubridate")
library("tidyr")
library("data.table")
library("readxl")
library("writexl")
library("countrycode")
library("dplyr")
library("lubridate")
library("tidyr")
library("data.table")
b_pop_total <-
data.frame(read_excel("data/input/static/base_population.xlsx",
sheet = "base_population"))
b_pop_hcw <-
data.frame(read_excel("data/input/static/base_hcw population.xlsx",
sheet = "base_hcw"))
# Reduce columns & rename
z_pop_total <- select(b_pop_total, c("COUNTRY_FK","GENDER_FK","AGEGROUP_FK",
"VALUE"))
colnames(z_pop_total) <- c("a_iso","gender","age_group","value")
z_pop_hcw <- select(b_pop_hcw, c("ISO3","Stock"))
colnames(z_pop_hcw) <- c("a_iso","a_pop_hcw")
z_pop_hcw <- z_pop_hcw %>%
mutate(a_pop_hcw = if_else(a_pop_hcw == 0, NA_real_, a_pop_hcw))
age_range12[] <- lapply(age_range12, function(x) ifelse(!is.na(x), paste0("Y", x), x))
age_range12
age_range18[] <- lapply(age_range18, function(x) ifelse(!is.na(x), paste0("Y", x), x))
age_range18
age_range60[] <- lapply(age_range60, function(x) ifelse(!is.na(x), paste0("Y", x), x))
age_range60
age_range12= (12:100)
age_range18 = (18:100)
age_range60 = (60:100)
age_range12[] <- lapply(age_range12, function(x) ifelse(!is.na(x), paste0("Y", x), x))
age_range12
age_range18[] <- lapply(age_range18, function(x) ifelse(!is.na(x), paste0("Y", x), x))
age_range18
age_range60[] <- lapply(age_range60, function(x) ifelse(!is.na(x), paste0("Y", x), x))
age_range60
z_pop_12p <- z_pop_total %>%
filter(
gender == "BOTH" & age_group%in%age_range12) %>%
group_by(a_iso) %>%
summarize_at("value",
sum,
na.rm = TRUE
)
colnames(z_pop_12p) <- c("a_iso","a_pop_12p")
# Filter for 18 and above
z_pop_18p <- z_pop_total %>%
filter(
gender == "BOTH" & age_group%in%age_range18) %>%
group_by(a_iso) %>%
summarize_at("value",
sum,
na.rm = TRUE
)
colnames(z_pop_18p) <- c("a_iso","a_pop_18p")
# Filter for 60 and above
z_pop_60p <- z_pop_total %>%
filter(
gender == "BOTH" & age_group%in%age_range60) %>%
group_by(a_iso) %>%
summarize_at("value",
sum,
na.rm = TRUE
)
colnames(z_pop_60p) <- c("a_iso","a_pop_60p")
z_pop_total_male <- z_pop_total %>%
filter(
gender == "MALE" & age_group == "ALL") %>%
group_by(a_iso) %>%
summarize_at("value",
sum,
na.rm = TRUE
)
colnames(z_pop_total_male) <- c("a_iso","a_pop_male")
# Filter for total, female
z_pop_total_fem <- z_pop_total %>%
filter(
gender == "FEMALE" & age_group == "ALL") %>%
group_by(a_iso) %>%
summarize_at("value",
sum,
na.rm = TRUE
)
colnames(z_pop_total_fem) <- c("a_iso","a_pop_fem")
# Consolidate population values into single dataframe
c_pop_disag <- left_join(z_pop_total_male, z_pop_total_fem, by = "a_iso") %>%
left_join(., z_pop_12p, by = "a_iso") %>%
left_join(., z_pop_18p, by = "a_iso") %>%
left_join(., z_pop_60p, by = "a_iso") %>%
full_join(., z_pop_hcw, by = "a_iso")
b_uptake_target <-
data.frame(read_excel("data/input/data_export_WIISE_V_COV_UPTAKE_TARGETGROUP_LAST_MONTH_LONG.xlsx",
sheet = "v_COV_UPTAKE_TARGETGROUP_LAST_M"))
b_uptake_gender <-
data.frame(read_excel("data/input/data_export_WIISE_V_COV_UPTAKE_GENDER_LAST_MONTH_LONG.xlsx",
sheet = "v_COV_UPTAKE_GENDER_LAST_MONTH_"))
# Reduce columns & rename
c_uptake_target <- select(b_uptake_target, c("ISO_3_CODE",
"DATE",
"TARGET_GROUP",
"N_VACC_DOSE1",
"N_VACC_LAST_DOSE"))
colnames(c_uptake_target) <- c("a_iso","date", "target_group","adm_a1d","adm_fv")
c_uptake_gender <- select(b_uptake_gender, c("ISO_3_CODE",
"DATE",
"GENDER",
"N_VACC_DOSE1",
"N_VACC_LAST_DOSE"))
colnames(c_uptake_gender) <- c("a_iso","date", "gender","adm_a1d","adm_fv")
# Sort for healthcare workers, remove target columns & rename
c_uptake_hcw <- filter(c_uptake_target, target_group == "HW")
c_uptake_hcw <- select(c_uptake_hcw, -"target_group")
colnames(c_uptake_hcw) <- c("a_iso","adm_date_hcw", "adm_a1d_hcw", "adm_fv_hcw")
# Sort for elderly / 60+, remove target columns & rename
c_uptake_60p <- filter(c_uptake_target, target_group == "OLDER_60")
c_uptake_60p <- select(c_uptake_60p, -"target_group")
colnames(c_uptake_60p) <- c("a_iso","adm_date_60p", "adm_a1d_60p", "adm_fv_60p")
# Sort for males, remove target columns & rename
c_uptake_male <- filter(c_uptake_gender, gender  == "MALE")
c_uptake_male <- select(c_uptake_male, -"gender")
colnames(c_uptake_male) <- c("a_iso","adm_date_gender", "adm_a1d_male", "adm_fv_male")
# Sort for females, remove target columns & rename
c_uptake_fem <- filter(c_uptake_gender, gender == "FEMALE")
c_uptake_fem <- select(c_uptake_fem, -c("gender", "date"))
colnames(c_uptake_fem) <- c("a_iso","adm_a1d_fem", "adm_fv_fem")
# Merge dataframes
c_uptake_disag <- full_join(c_uptake_hcw, c_uptake_60p, by = "a_iso") %>%
full_join(., c_uptake_male, by = "a_iso") %>%
full_join(., c_uptake_fem, by = "a_iso")
install.packages("languageserver")
q()
