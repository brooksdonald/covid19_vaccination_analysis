source("eda/vxrate/run_vxrate.r")
source("eda/supplies/run_supplies.r")
source("eda/coverage/run_coverage.r")
source("eda/product/run_product.r")
source("eda/rank-bin/run_rank_bin.r")
source("eda/consolidate/run_consolidate.r")
vxrate_env <- run_vxrate(entity_characteristics, population_data, uptake_gender_data, c_vxrate_latest)
supplies_env <- run_eda_supplies(a_data, supply_secured, delivery_courses_doses)
coverage_env <- run_coverage(a_data)
product_env <- run_product(a_data, base_env$b_smartsheet, base_env$b_csl)
ranking_env <- run_binning(a_data)
consolidate_env <- run_consolidate(a_data)
# rows 2698 - 3280
run_consolidate <- function(a_data, env = .GlobalEnv) {
source("eda/consolidate/consolidate_base_file.r")
source("eda/consolidate/consolidate_vxrate.r")
source("eda/consolidate/consolidate_targets.r")
source("eda/consolidate/consolidate_supplies_utilization.r")
print(" > Starting local environment for consolidation summary")
print(" > Consolidating base file...")
condense_list <- load_base_condense_file(a_data)
print(" > Done.")
print(" > Consolidating Vaccination rate...")
vrcat_list <- vxrate(condense_list)
print(" > Done.")
print(" > Consolidating targets...")
tgt_list <- targets(condense_list)
print(" > Done.")
print(" > Consolidating Supplies & Product utilization...")
supp_list <- supplies_cons(condense_list)
print(" > Done.")
print(" > Loading eda consolidation data back to global environment...")
env$vrcat_list <- vrcat_list
env$e_vrcat_all <- vrcat_list[["all"]]
env$e_trend_all <- vrcat_list[["trend"]]
env$e_booster_all <- vrcat_list[["booster"]]
env$tgt_list <- tgt_list
env$e_tar_past_all <- tgt_list
env$e_tar_cur_all <- tgt_list
env$e_tar_cur_scale_all <- tgt_list
env$supp_list <- supp_list
env$e_secdelpu_all <- supp_list
return(environment())
}
run_consolidate(a_data)
# rows 2698 - 3280
run_consolidate <- function(a_data, env = .GlobalEnv) {
source("eda/consolidate/consolidate_base_file.r")
source("eda/consolidate/consolidate_vxrate.r")
source("eda/consolidate/consolidate_targets.r")
source("eda/consolidate/consolidate_supplies_utilization.r")
print(" > Starting local environment for consolidation summary")
print(" > Consolidating base file...")
condense_list <- load_base_condense_file(a_data)
print(" > Done.")
print(" > Consolidating Vaccination rate...")
vrcat_list <- vxrate(condense_list)
print(" > Done.")
print(" > Consolidating targets...")
tgt_list <- targets(condense_list)
print(" > Done.")
print(" > Consolidating Supplies & Product utilization...")
supp_list <- supplies_cons(condense_list)
print(" > Done.")
print(" > Loading eda consolidation data back to global environment...")
env$vrcat_list <- vrcat_list
env$e_vrcat_all <- vrcat_list[["all"]]
env$e_trend_all <- vrcat_list[["trend"]]
env$e_booster_all <- vrcat_list[["booster"]]
env$tgt_list <- tgt_list
env$e_tar_past_all <- tgt_list
env$e_tar_cur_all <- tgt_list
env$e_tar_cur_scale_all <- tgt_list
env$supp_list <- supp_list
env$e_secdelpu_all <- supp_list
return(environment())
}
run_consolidate(a_data)
# rows 2698 - 3280
run_consolidate <- function(a_data, env = .GlobalEnv) {
source("eda/consolidate/consolidate_base_file.r")
source("eda/consolidate/consolidate_vxrate.r")
source("eda/consolidate/consolidate_targets.r")
source("eda/consolidate/consolidate_supplies_utilization.r")
print(" > Starting local environment for consolidation summary")
print(" > Consolidating base file...")
condense_list <- load_base_condense_file(a_data)
print(" > Done.")
print(" > Consolidating Vaccination rate...")
vrcat_list <- vxrate(condense_list)
print(" > Done.")
print(" > Consolidating targets...")
tgt_list <- targets(condense_list)
print(" > Done.")
print(" > Consolidating Supplies & Product utilization...")
supp_list <- supplies_cons(condense_list)
print(" > Done.")
print(" > Loading eda consolidation data back to global environment...")
env$vrcat_list <- vrcat_list
env$e_vrcat_all <- vrcat_list[["all"]]
env$e_trend_all <- vrcat_list[["trend"]]
env$e_booster_all <- vrcat_list[["booster"]]
env$tgt_list <- tgt_list
env$e_tar_past_all <- tgt_list
env$e_tar_cur_all <- tgt_list
env$e_tar_cur_scale_all <- tgt_list
env$supp_list <- supp_list
env$e_secdelpu_all <- supp_list
return(environment())
}
run_consolidate(a_data)
# rows 2698 - 3280
run_consolidate <- function(a_data, env = .GlobalEnv) {
source("eda/consolidate/consolidate_base_file.r")
source("eda/consolidate/consolidate_vxrate.r")
source("eda/consolidate/consolidate_targets.r")
source("eda/consolidate/consolidate_supplies_utilization.r")
print(" > Starting local environment for consolidation summary")
print(" > Consolidating base file...")
condense_list <- load_base_condense_file(a_data)
print(" > Done.")
print(" > Consolidating Vaccination rate...")
vrcat_list <- vxrate(condense_list)
print(" > Done.")
print(" > Consolidating targets...")
tgt_list <- targets(condense_list)
print(" > Done.")
print(" > Consolidating Supplies & Product utilization...")
supp_list <- supplies_cons(condense_list)
print(" > Done.")
print(" > Loading eda consolidation data back to global environment...")
env$vrcat_list <- vrcat_list
env$e_vrcat_all <- vrcat_list[["all"]]
env$e_trend_all <- vrcat_list[["trend"]]
env$e_booster_all <- vrcat_list[["booster"]]
env$tgt_list <- tgt_list
env$e_tar_past_all <- tgt_list
env$e_tar_cur_all <- tgt_list
env$e_tar_cur_scale_all <- tgt_list
env$supp_list <- supp_list
env$e_secdelpu_all <- supp_list
return(environment())
}
run_consolidate(a_data)
library("readxl")
library("writexl")
library("countrycode")
library("dplyr")
library("lubridate")
library("tidyr")
library("data.table")
library("bit64")
# HELPERS
source("helpers/joins.r")
source("helpers/transformations.r")
# ETL
source("src/base/run_base.r")
source("src/entity/run_entity.r")
source("src/population/run_population.r")
source("src/supply/run_supply.R")
source("src/vaccines/run_vaccines.r")
base_env <- run_base()
entity_env <- run_entity()
pop_env <- run_population()
supply_env <- run_supply()
vaccines_env <- run_vaccines(entity_characteristics)
# EDA
source("eda/vxrate/run_vxrate.r")
source("eda/supplies/run_supplies.r")
source("eda/coverage/run_coverage.r")
source("eda/product/run_product.r")
source("eda/rank-bin/run_rank_bin.r")
source("eda/consolidate/run_consolidate.r")
vxrate_env <- run_vxrate(entity_characteristics, population_data, uptake_gender_data, c_vxrate_latest)
supplies_env <- run_eda_supplies(a_data, supply_secured, delivery_courses_doses)
coverage_env <- run_coverage(a_data)
product_env <- run_product(a_data, base_env$b_smartsheet, base_env$b_csl)
ranking_env <- run_binning(a_data)
consolidate_env <- run_consolidate(a_data)
library("readxl")
library("writexl")
library("countrycode")
library("dplyr")
library("lubridate")
library("tidyr")
library("data.table")
library("bit64")
# HELPERS
source("helpers/joins.r")
source("helpers/transformations.r")
# ETL
source("src/base/run_base.r")
source("src/entity/run_entity.r")
source("src/population/run_population.r")
source("src/supply/run_supply.R")
source("src/vaccines/run_vaccines.r")
base_env <- run_base()
entity_env <- run_entity()
pop_env <- run_population()
supply_env <- run_supply()
vaccines_env <- run_vaccines(entity_characteristics)
# EDA
source("eda/vxrate/run_vxrate.r")
source("eda/supplies/run_supplies.r")
source("eda/coverage/run_coverage.r")
source("eda/product/run_product.r")
source("eda/rank-bin/run_rank_bin.r")
source("eda/consolidate/run_consolidate.r")
vxrate_env <- run_vxrate(entity_characteristics, population_data, uptake_gender_data, c_vxrate_latest)
supplies_env <- run_eda_supplies(a_data, supply_secured, delivery_courses_doses)
coverage_env <- run_coverage(a_data)
product_env <- run_product(a_data, base_env$b_smartsheet, base_env$b_csl)
ranking_env <- run_binning(a_data)
consolidate_env <- run_consolidate(a_data)
# Create values table
values_table <- function() {
z_values <- data.frame(c("Text"))
z_values$ig_amc_lic <- 25
z_values$ig_amc_lmic <- 53
z_values$ig_amc_umic <- 12
z_values$wr_amc_afr <- 39
z_values$wr_amc_amr <- 10
z_values$wr_amc_emr <- 11
z_values$wr_amc_eur <- 6
z_values$wr_amc_sear <- 9
z_values$wr_amc_wpr <- 15
z_values$pop_amc_1m <- 20
z_values$pop_amc_10m <- 22
z_values$pop_amc_100m <- 40
z_values$pop_amc_100mp <- 8
z_values$pop_amc <- 3889355899
z_values$pop_amc_hcw <- 17570377
z_values$pop_amc_10 <- z_values$pop_amc * 0.1
z_values$pop_amc_20 <- z_values$pop_amc * 0.2
z_values$pop_amc_40 <- z_values$pop_amc * 0.4
z_values$pop_amc_70 <- z_values$pop_amc * 0.7
z_values$ig_amc_hcw_lic <- sum(a_data$adm_fv_hcw_repstat == "Reporting" & a_data$a_covax_status == "AMC" & a_data$a_income_group == "LIC", na.rm=TRUE)
z_values$ig_amc_hcw_lmic <- sum(a_data$adm_fv_hcw_repstat == "Reporting" & a_data$a_covax_status == "AMC" & a_data$a_income_group == "LMIC", na.rm=TRUE)
z_values$ig_amc_hcw_umic <- sum(a_data$adm_fv_hcw_repstat == "Reporting" & a_data$a_covax_status == "AMC" & a_data$a_income_group == "UMIC", na.rm=TRUE)
z_values$pop_amc_hcw_1m <- sum(a_data$adm_fv_hcw_repstat == "Reporting" & a_data$a_covax_status == "AMC" & a_data$a_pop_cat == "1) <1M", na.rm=TRUE)
z_values$pop_amc_hcw_10m <- sum(a_data$adm_fv_hcw_repstat == "Reporting" & a_data$a_covax_status == "AMC" & a_data$a_pop_cat == "2) 1-10M", na.rm=TRUE)
z_values$pop_amc_hcw_100m <- sum(a_data$adm_fv_hcw_repstat == "Reporting" & a_data$a_covax_status == "AMC" & a_data$a_pop_cat == "3) 10-100M", na.rm=TRUE)
z_values$pop_amc_hcw_100mp <- sum(a_data$adm_fv_hcw_repstat == "Reporting" & a_data$a_covax_status == "AMC" & a_data$a_pop_cat == "4) 100M+", na.rm=TRUE)
z_values$wr_amc_hcw_afr <- sum(a_data$adm_fv_hcw_repstat == "Reporting" & a_data$a_covax_status == "AMC" & a_data$a_who_region == "AFR", na.rm=TRUE)
z_values$wr_amc_hcw_amr <- sum(a_data$adm_fv_hcw_repstat == "Reporting" & a_data$a_covax_status == "AMC" & a_data$a_who_region == "AMR", na.rm=TRUE)
z_values$wr_amc_hcw_emr <- sum(a_data$adm_fv_hcw_repstat == "Reporting" & a_data$a_covax_status == "AMC" & a_data$a_who_region == "EMR", na.rm=TRUE)
z_values$wr_amc_hcw_eur <- sum(a_data$adm_fv_hcw_repstat == "Reporting" & a_data$a_covax_status == "AMC" & a_data$a_who_region == "EUR", na.rm=TRUE)
z_values$wr_amc_hcw_sear <- sum(a_data$adm_fv_hcw_repstat == "Reporting" & a_data$a_covax_status == "AMC" & a_data$a_who_region == "SEAR", na.rm=TRUE)
z_values$wr_amc_hcw_wpr <- sum(a_data$adm_fv_hcw_repstat == "Reporting" & a_data$a_covax_status == "AMC" & a_data$a_who_region == "WPR", na.rm=TRUE)
z_values$ig_amc_60p_lic <- sum(a_data$adm_fv_60p_repstat == "Reporting" & a_data$a_covax_status == "AMC" & a_data$a_income_group == "LIC", na.rm=TRUE)
z_values$ig_amc_60p_lmic <- sum(a_data$adm_fv_60p_repstat == "Reporting" & a_data$a_covax_status == "AMC" & a_data$a_income_group == "LMIC", na.rm=TRUE)
z_values$ig_amc_60p_umic <- sum(a_data$adm_fv_60p_repstat == "Reporting" & a_data$a_covax_status == "AMC" & a_data$a_income_group == "UMIC", na.rm=TRUE)
z_values$pop_amc_60p_1m <- sum(a_data$adm_fv_60p_repstat == "Reporting" & a_data$a_covax_status == "AMC" & a_data$a_pop_cat == "1) <1M", na.rm=TRUE)
z_values$pop_amc_60p_10m <- sum(a_data$adm_fv_60p_repstat == "Reporting" & a_data$a_covax_status == "AMC" & a_data$a_pop_cat == "2) 1-10M", na.rm=TRUE)
z_values$pop_amc_60p_100m <- sum(a_data$adm_fv_60p_repstat == "Reporting" & a_data$a_covax_status == "AMC" & a_data$a_pop_cat == "3) 10-100M", na.rm=TRUE)
z_values$pop_amc_60p_100mp <- sum(a_data$adm_fv_60p_repstat == "Reporting" & a_data$a_covax_status == "AMC" & a_data$a_pop_cat == "4) 100M+", na.rm=TRUE)
z_values$wr_amc_60p_afr <- sum(a_data$adm_fv_60p_repstat == "Reporting" & a_data$a_covax_status == "AMC" & a_data$a_who_region == "AFR", na.rm=TRUE)
z_values$wr_amc_60p_amr <- sum(a_data$adm_fv_60p_repstat == "Reporting" & a_data$a_covax_status == "AMC" & a_data$a_who_region == "AMR", na.rm=TRUE)
z_values$wr_amc_60p_emr <- sum(a_data$adm_fv_60p_repstat == "Reporting" & a_data$a_covax_status == "AMC" & a_data$a_who_region == "EMR", na.rm=TRUE)
z_values$wr_amc_60p_eur <- sum(a_data$adm_fv_60p_repstat == "Reporting" & a_data$a_covax_status == "AMC" & a_data$a_who_region == "EUR", na.rm=TRUE)
z_values$wr_amc_60p_sear <- sum(a_data$adm_fv_60p_repstat == "Reporting" & a_data$a_covax_status == "AMC" & a_data$a_who_region == "SEAR", na.rm=TRUE)
z_values$wr_amc_60p_wpr <- sum(a_data$adm_fv_60p_repstat == "Reporting" & a_data$a_covax_status == "AMC" & a_data$a_who_region == "WPR", na.rm=TRUE)
z_values$ig_amc_gen_lic <- sum(a_data$adm_fv_gen_repstat == "Reporting" & a_data$a_covax_status == "AMC" & a_data$a_income_group == "LIC", na.rm=TRUE)
z_values$ig_amc_gen_lmic <- sum(a_data$adm_fv_gen_repstat == "Reporting" & a_data$a_covax_status == "AMC" & a_data$a_income_group == "LMIC", na.rm=TRUE)
z_values$ig_amc_gen_umic <- sum(a_data$adm_fv_gen_repstat == "Reporting" & a_data$a_covax_status == "AMC" & a_data$a_income_group == "UMIC", na.rm=TRUE)
z_values$pop_amc_gen_1m <- sum(a_data$adm_fv_gen_repstat == "Reporting" & a_data$a_covax_status == "AMC" & a_data$a_pop_cat == "1) <1M", na.rm=TRUE)
z_values$pop_amc_gen_10m <- sum(a_data$adm_fv_gen_repstat == "Reporting" & a_data$a_covax_status == "AMC" & a_data$a_pop_cat == "2) 1-10M", na.rm=TRUE)
z_values$pop_amc_gen_100m <- sum(a_data$adm_fv_gen_repstat == "Reporting" & a_data$a_covax_status == "AMC" & a_data$a_pop_cat == "3) 10-100M", na.rm=TRUE)
z_values$pop_amc_gen_100mp <- sum(a_data$adm_fv_gen_repstat == "Reporting" & a_data$a_covax_status == "AMC" & a_data$a_pop_cat == "4) 100M+", na.rm=TRUE)
z_values$wr_amc_gen_afr <- sum(a_data$adm_fv_gen_repstat == "Reporting" & a_data$a_covax_status == "AMC" & a_data$a_who_region == "AFR", na.rm=TRUE)
z_values$wr_amc_gen_amr <- sum(a_data$adm_fv_gen_repstat == "Reporting" & a_data$a_covax_status == "AMC" & a_data$a_who_region == "AMR", na.rm=TRUE)
z_values$wr_amc_gen_emr <- sum(a_data$adm_fv_gen_repstat == "Reporting" & a_data$a_covax_status == "AMC" & a_data$a_who_region == "EMR", na.rm=TRUE)
z_values$wr_amc_gen_eur <- sum(a_data$adm_fv_gen_repstat == "Reporting" & a_data$a_covax_status == "AMC" & a_data$a_who_region == "EUR", na.rm=TRUE)
z_values$wr_amc_gen_sear <- sum(a_data$adm_fv_gen_repstat == "Reporting" & a_data$a_covax_status == "AMC" & a_data$a_who_region == "SEAR", na.rm=TRUE)
z_values$wr_amc_gen_wpr <- sum(a_data$adm_fv_gen_repstat == "Reporting" & a_data$a_covax_status == "AMC" & a_data$a_who_region == "WPR", na.rm=TRUE)
return(z_values)
}
table_val <- values_table()
View(values_table)
View(values_table)
View(table_val)
library("readxl")
library("writexl")
library("countrycode")
library("dplyr")
library("lubridate")
library("tidyr")
library("data.table")
library("bit64")
# HELPERS
source("helpers/joins.r")
source("helpers/transformations.r")
# ETL
source("src/base/run_base.r")
source("src/entity/run_entity.r")
source("src/population/run_population.r")
source("src/supply/run_supply.R")
source("src/vaccines/run_vaccines.r")
base_env <- run_base()
entity_env <- run_entity()
pop_env <- run_population()
supply_env <- run_supply()
vaccines_env <- run_vaccines(entity_characteristics)
# EDA
source("eda/vxrate/run_vxrate.r")
source("eda/supplies/run_supplies.r")
source("eda/coverage/run_coverage.r")
source("eda/product/run_product.r")
source("eda/rank-bin/run_rank_bin.r")
source("eda/consolidate/run_consolidate.r")
vxrate_env <- run_vxrate(entity_characteristics, population_data, uptake_gender_data, c_vxrate_latest)
supplies_env <- run_eda_supplies(a_data, supply_secured, delivery_courses_doses)
coverage_env <- run_coverage(a_data)
product_env <- run_product(a_data, base_env$b_smartsheet, base_env$b_csl)
ranking_env <- run_binning(a_data)
consolidate_env <- run_consolidate(a_data)
View(z_values)
library("readxl")
library("writexl")
library("countrycode")
library("dplyr")
library("lubridate")
library("tidyr")
library("data.table")
library("bit64")
# HELPERS
source("helpers/joins.r")
source("helpers/transformations.r")
# ETL
source("src/base/run_base.r")
source("src/entity/run_entity.r")
source("src/population/run_population.r")
source("src/supply/run_supply.R")
source("src/vaccines/run_vaccines.r")
base_env <- run_base()
entity_env <- run_entity()
pop_env <- run_population()
supply_env <- run_supply()
vaccines_env <- run_vaccines(entity_characteristics)
# EDA
source("eda/vxrate/run_vxrate.r")
source("eda/supplies/run_supplies.r")
source("eda/coverage/run_coverage.r")
source("eda/product/run_product.r")
source("eda/rank-bin/run_rank_bin.r")
source("eda/consolidate/run_consolidate.r")
vxrate_env <- run_vxrate(entity_characteristics, population_data, uptake_gender_data, c_vxrate_latest)
supplies_env <- run_eda_supplies(a_data, supply_secured, delivery_courses_doses)
coverage_env <- run_coverage(a_data)
product_env <- run_product(a_data, base_env$b_smartsheet, base_env$b_csl)
ranking_env <- run_binning(a_data)
consolidate_env <- run_consolidate(a_data)
vxrate_change_cat <- function(a_data,b_vxrate_change_lw) {
# Select data
c_data_dvr_lm_cat <-
select(
a_data,
c(
"a_iso",
"dvr_4wk_td_change_lm_per_cat",
"a_covax_status",
"intro_status"
)
)
f_dvr_change_count <- helper_join_dataframe_list(c_data_dvr_lm_cat, join_by = "a_iso")
f_dvr_change_count <- helper_join_dataframe_list(b_vxrate_change_lw, join_by = "a_iso")
f_dvr_change_count <- filter(f_dvr_change_count,
a_covax_status == "AMC" &
intro_status == "Product introduced"
)
f_dvr_change_count <-
select(
f_dvr_change_count,
c(
"a_iso",
"dvr_4wk_td_change_lm_per_cat",
"dvr_4wk_td_change_lw_lm_per_cat"
)
)
colnames(f_dvr_change_count) <- c(
"a_iso",
"dvr_change_cat_lm_cur",
"dvr_change_cat_lm_lw"
)
f_dvr_change_count_cur <- f_dvr_change_count %>%
group_by(dvr_change_cat_lm_cur) %>%
summarise(count_cur = n())
colnames(f_dvr_change_count_cur) <- c(
"cat",
"count_cur"
)
f_dvr_change_count_lw <- f_dvr_change_count %>%
group_by(dvr_change_cat_lm_lw) %>%
summarise(count_lw = n())
colnames(f_dvr_change_count_lw) <- c(
"cat",
"count_lw"
)
f_dvr_change_count <- helper_join_dataframe_list(f_dvr_change_count_cur, join_by = "cat")
f_dvr_change_count <- helper_join_dataframe_list(f_dvr_change_count_lw, join_by = "cat")
f_dvr_change_count <- f_dvr_change_count %>%
mutate(count_change = count_cur - count_lw)
return(f_dvr_change_count)
}
test_fdvr <- vxrate_change_cat(a_data,b_vxrate_change_lw)
test_fdvr <- vxrate_change_cat(a_data,b_vxrate_change_lw)
vxrate_change_cat <- function(a_data,b_vxrate_change_lw) {
# Select data
c_data_dvr_lm_cat <-
select(
a_data,
c(
"a_iso",
"dvr_4wk_td_change_lm_per_cat",
"a_covax_status",
"intro_status"
)
)
f_dvr_change_count <- helper_join_dataframe_list(c_data_dvr_lm_cat, join_by = "a_iso")
f_dvr_change_count <- helper_join_dataframe_list(b_vxrate_change_lw, join_by = "a_iso")
f_dvr_change_count <- filter(f_dvr_change_count,
a_covax_status == "AMC" &
intro_status == "Product introduced"
)
f_dvr_change_count <-
select(
f_dvr_change_count,
c(
"a_iso",
"dvr_4wk_td_change_lm_per_cat",
"dvr_4wk_td_change_lw_lm_per_cat"
)
)
colnames(f_dvr_change_count) <- c(
"a_iso",
"dvr_change_cat_lm_cur",
"dvr_change_cat_lm_lw"
)
f_dvr_change_count_cur <- f_dvr_change_count %>%
group_by(dvr_change_cat_lm_cur) %>%
summarise(count_cur = n())
colnames(f_dvr_change_count_cur) <- c(
"cat",
"count_cur"
)
f_dvr_change_count_lw <- f_dvr_change_count %>%
group_by(dvr_change_cat_lm_lw) %>%
summarise(count_lw = n())
colnames(f_dvr_change_count_lw) <- c(
"cat",
"count_lw"
)
f_dvr_change_count <- helper_join_dataframe_list(f_dvr_change_count_cur, join_by = "cat")
f_dvr_change_count <- helper_join_dataframe_list(f_dvr_change_count_lw, join_by = "cat")
f_dvr_change_count <- f_dvr_change_count %>%
mutate(count_change = count_cur - count_lw)
return(f_dvr_change_count)
}
vxrate_change_cat <- function(a_data, b_vxrate_change_lw) {
# Select data
c_data_dvr_lm_cat <-
select(
a_data,
c(
"a_iso",
"dvr_4wk_td_change_lm_per_cat",
"a_covax_status",
"intro_status"
)
)
f_dvr_change_count <- helper_join_dataframe_list(c_data_dvr_lm_cat, join_by = "a_iso")
f_dvr_change_count <- helper_join_dataframe_list(b_vxrate_change_lw, join_by = "a_iso")
f_dvr_change_count <- filter(f_dvr_change_count,
a_covax_status == "AMC" &
intro_status == "Product introduced"
)
f_dvr_change_count <-
select(
f_dvr_change_count,
c(
"a_iso",
"dvr_4wk_td_change_lm_per_cat",
"dvr_4wk_td_change_lw_lm_per_cat"
)
)
colnames(f_dvr_change_count) <- c(
"a_iso",
"dvr_change_cat_lm_cur",
"dvr_change_cat_lm_lw"
)
f_dvr_change_count_cur <- f_dvr_change_count %>%
group_by(dvr_change_cat_lm_cur) %>%
summarise(count_cur = n())
colnames(f_dvr_change_count_cur) <- c(
"cat",
"count_cur"
)
f_dvr_change_count_lw <- f_dvr_change_count %>%
group_by(dvr_change_cat_lm_lw) %>%
summarise(count_lw = n())
colnames(f_dvr_change_count_lw) <- c(
"cat",
"count_lw"
)
f_dvr_change_count <- helper_join_dataframe_list(f_dvr_change_count_cur, join_by = "cat")
f_dvr_change_count <- helper_join_dataframe_list(f_dvr_change_count_lw, join_by = "cat")
f_dvr_change_count <- f_dvr_change_count %>%
mutate(count_change = count_cur - count_lw)
return(f_dvr_change_count)
test_fdvr <- vxrate_change_cat(a_data, b_vxrate_change_lw)
test_fdvr <- vxrate_change_cat(a_data,b_vxrate_change_lw)
View(test_fdvr)
