install.packages("here")
# rows 600 - 978
library("readxl")
library("writexl")
library("countrycode")
library("dplyr")
library("lubridate")
library("tidyr")
library("data.table")
library("here")
source("src/population/population_base.r")
source("src/population/population_hcw.r")
source("src/population/population_uptake_gender.r")
source("src/population/population_uptake_target_group.r")
run_population <- function(local = new.env()) {
print(" > Starting local environment for base population")
print(" > Population healthcare workers...")
population_hcw <- load_population_hcw()
population_hcw <- transform_population_hcw(
population_hcw
)
print(" > Done.")
print(" > Base population...")
population_base <- load_base_population()
local$population_data <- transform_base_population(
population_base, population_hcw
)
print(" > Done.")
print(" > Uptake target groups...")
uptake_target_group <- load_population_target_groups()
uptake_target_group <- transform_population_target_groups(
uptake_target_group
)
print(" > Done.")
print(" > Uptake gender...")
uptake_gender <- load_population_target_gender()
local$uptake_gender_data <- transform_population_target_gender(
uptake_gender, uptake_target_group
)
print(" > Done.")
print(" > Returning to local environment. ")
print(" > Loading data back to global environment...")
.GlobalEnv$population_data <- local$population_data
.GlobalEnv$uptake_gender_data <- local$uptake_gender_data
rm(list = ls())
}
run_population()
View(run_population)
View(run_population)
load_population_target_gender <- function() {
print(" >> Loading COV Uptake gender data...")
uptake_gender <- data.frame(
read_excel("data/input/data_export_WIISE_V_COV_UPTAKE_GENDER_LAST_MONTH_LONG.xlsx",
sheet = "v_COV_UPTAKE_GENDER_LAST_MONTH_"
)
)
# Reduce columns & rename
print(" >> Selecting uptake gender data...")
uptake_gender <-
select(
uptake_gender,
c
(
"ISO_3_CODE",
"DATE",
"GENDER",
"N_VACC_DOSE1",
"N_VACC_LAST_DOSE"
)
)
View(uptake_gender)
load_population_target_gender <- function() {
print(" >> Loading COV Uptake gender data...")
uptake_gender <- data.frame(
read_excel("data/input/data_export_WIISE_V_COV_UPTAKE_GENDER_LAST_MONTH_LONG.xlsx",
sheet = "v_COV_UPTAKE_GENDER_LAST_MONTH_"
)
)
# Reduce columns & rename
print(" >> Selecting uptake gender data...")
uptake_gender <-
select(
uptake_gender,
c
(
"ISO_3_CODE",
"DATE",
"GENDER",
"N_VACC_DOSE1",
"N_VACC_LAST_DOSE"
)
)
print(" >> Renaming Columns...")
colnames(uptake_gender) <- c(
"a_iso",
"date",
"gender",
"adm_a1d",
"adm_fv"
)
return(uptake_gender)
}
uptake_gender
uptake_gender
transform_population_target_gender <- function(uptake_gender, uptake_target_group) {
data_frame <- list()
for (gender in c("MALE", "FEMALE")) {
df <- uptake_gender %>%
filter(
gender == "MALE"
)
colnames(df) <- c("a_iso","adm_date_gender", "adm_a1d_male", "adm_fv_male")
data_frame <- append(data_frame, list(df))
df <-uptake_gender %>%
filter(
gender == "FEMALE"
)
colnames(df) <- c("a_iso","adm_a1d_fem", "adm_fv_fem")
data_frame <- append(data_frame, list(df))
}
# Consolidate population uptake gender into a single dataframe
data_frame <- append(data_frame, list(uptake_gender))
uptake_gender_data <- Reduce(
function(x, y) merge(x, y, by = "a_iso", all = TRUE),
data_frame
)
return(uptake_gender_data)
}
data_frame <- append(data_frame, list(uptake_gender))
# rows 600 - 978
library("readxl")
library("writexl")
library("countrycode")
library("dplyr")
library("lubridate")
library("tidyr")
library("data.table")
library("here")
source("src/population/population_base.r")
source("src/population/population_hcw.r")
source("src/population/population_uptake_gender.r")
source("src/population/population_uptake_target_group.r")
run_population <- function(local = new.env()) {
print(" > Starting local environment for base population")
print(" > Population healthcare workers...")
population_hcw <- load_population_hcw()
population_hcw <- transform_population_hcw(
population_hcw
)
print(" > Done.")
print(" > Base population...")
population_base <- load_base_population()
local$population_data <- transform_base_population(
population_base, population_hcw
)
print(" > Done.")
print(" > Uptake target groups...")
uptake_target_group <- load_population_target_groups()
uptake_target_group <- transform_population_target_groups(
uptake_target_group
)
print(" > Done.")
print(" > Uptake gender...")
uptake_gender <- load_population_target_gender()
local$uptake_gender_data <- transform_population_target_gender(
uptake_gender, uptake_target_group
)
print(" > Done.")
print(" > Returning to local environment. ")
print(" > Loading data back to global environment...")
.GlobalEnv$population_data <- local$population_data
.GlobalEnv$uptake_gender_data <- local$uptake_gender_data
rm(list = ls())
}
run_population()
